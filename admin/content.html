<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; base-uri 'self'; object-src 'none'; frame-ancestors 'none'; form-action 'self'; img-src 'self' data: https:; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; font-src 'self' https://cdnjs.cloudflare.com data:; script-src 'self' 'unsafe-inline' https://www.gstatic.com https://www.googleapis.com https://cdnjs.cloudflare.com; script-src-attr 'none'; connect-src 'self' https://*.googleapis.com https://*.firebaseio.com https://www.googleapis.com;">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Edit Site Content</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="icon" type="image/x-icon" href="../image/Headshot.jpg">
  <style>
    body { background: linear-gradient(135deg, #020212 0%, #0f0a1a 100%); color: #f0f0f0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; min-height: 100vh; }
    header { background: linear-gradient(135deg, #1B16A8 0%, #020212 100%); padding: 20px 0; border-bottom: 1px solid rgba(124,58,237,0.2); position: sticky; top: 0; z-index: 100; }
    .header-content { max-width: 1200px; margin: 0 auto; padding: 0 20px; display: flex; justify-content: space-between; align-items: center; }
    .logo { font-size: 1.6rem; font-weight: 800; background: linear-gradient(135deg, #1B16A8, #7C3AED); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; display: flex; align-items: center; gap: 8px; }
    .header-actions { display: flex; gap: 12px; align-items: center; }
    .logout-btn, .back-btn { padding: 8px 16px; border-radius: 8px; border: 2px solid #7C3AED; background: transparent; color: #7C3AED; cursor: pointer; font-weight: 600; font-size: 0.85rem; }
    .logout-btn:hover, .back-btn:hover { background: rgba(124,58,237,0.1); }
    .container { max-width: 1200px; margin: 0 auto; padding: 32px 20px 60px; }
    h1.page-title { font-size: 2rem; margin-bottom: 12px; }
    p.page-subtitle { color: #9ca3af; font-size: 0.95rem; margin-bottom: 18px; }

    .page-tabs { display: inline-flex; flex-wrap: wrap; gap: 8px; margin-bottom: 22px; background: rgba(15,23,42,0.7); padding: 6px; border-radius: 999px; border: 1px solid rgba(148,163,184,0.4); }
    .page-tab { border: none; background: transparent; color: #e5e7eb; padding: 7px 14px; border-radius: 999px; font-size: 0.9rem; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 6px; opacity: 0.75; }
    .page-tab i { font-size: 0.95rem; }
    .page-tab.active { background: linear-gradient(135deg, #1B16A8, #7C3AED); opacity: 1; }

    .section { background: radial-gradient(circle at top left, rgba(124,58,237,0.2), transparent 55%), linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border: 1px solid rgba(124,58,237,0.25); border-radius: 18px; padding: 24px 22px; box-shadow: 0 18px 45px rgba(0,0,0,0.45); margin-bottom: 24px; display: none; }
    .section.active { display: block; }
    .section h2 { font-size: 1.4rem; margin-bottom: 16px; color: #7C3AED; display: flex; align-items: center; gap: 10px; }
    details { margin-bottom: 12px; background: rgba(0,0,0,0.15); border-radius: 12px; padding: 10px 14px; }
    summary { cursor: pointer; font-weight: 600; color: #ddd; }
    .form-group { margin-top: 14px; margin-bottom: 18px; }
    .form-group label { display: block; margin-bottom: 6px; color: #bbb; font-weight: 600; font-size: 0.9rem; }
    .form-group input, .form-group textarea { width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid rgba(124,58,237,0.3); background: rgba(255,255,255,0.05); color: #f0f0f0; font-size: 0.9rem; }
    .form-group textarea { min-height: 70px; resize: vertical; }
    .btn { padding: 10px 18px; border-radius: 8px; border: none; background: linear-gradient(135deg, #1B16A8, #7C3AED); color: #fff; font-weight: 600; cursor: pointer; font-size: 0.9rem; }
    .btn:hover { box-shadow: 0 10px 30px rgba(123,58,237,0.35); transform: translateY(-1px); }
    .message { padding: 14px; border-radius: 10px; margin-bottom: 18px; display: none; font-weight: 600; }
    .message.show { display: block; }
    .message.success { background: rgba(76,175,80,0.2); border: 1px solid #4caf50; color: #81c784; }
    .message.error { background: rgba(244,67,54,0.2); border: 1px solid #f44336; color: #ef5350; }

    .preview-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 18px; margin-top: 18px; }
    .preview-card { background: rgba(15,23,42,0.9); border-radius: 14px; border: 1px solid rgba(148,163,184,0.35); padding: 14px 16px; }
    .preview-card h3 { font-size: 0.95rem; margin-bottom: 8px; color: #e5e7eb; display: flex; align-items: center; gap: 6px; }
    .preview-card h3 span.label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.08em; color: #9ca3af; }
    .page-preview { background: radial-gradient(circle at top left, rgba(37,99,235,0.25), transparent 55%), linear-gradient(135deg, #020617 0%, #020617 100%); border-radius: 12px; padding: 14px 14px 16px; min-height: 80px; }
    .page-preview h4 { font-size: 1.1rem; margin-bottom: 4px; color: #e5e7eb; }
    .page-preview p { font-size: 0.9rem; color: #9ca3af; margin-bottom: 4px; }
    .page-preview .preview-tagline { font-size: 0.85rem; color: #a5b4fc; margin-bottom: 6px; }
    .page-preview .preview-cta { margin-top: 6px; display: inline-block; padding: 6px 10px; border-radius: 999px; background: rgba(124,58,237,0.2); color: #e5e7eb; font-size: 0.82rem; }

    @media (max-width: 640px) {
      .page-tabs { width: 100%; justify-content: flex-start; overflow-x: auto; }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <div class="logo"><i class="fas fa-pen-to-square"></i> Edit Site Content</div>
      <div class="header-actions">
        <button class="back-btn" id="backBtn" type="button">&larr; Back to Dashboard</button>
        <button class="logout-btn" id="logoutBtn" type="button">Logout</button>
      </div>
    </div>
  </header>

  <div class="container">
    <h1 class="page-title">Site Content Management</h1>
    <p class="page-subtitle">Choose a page, adjust the copy, and compare what is live now versus your draft changes before publishing.</p>
    <div class="page-tabs">
      <button class="page-tab active" data-page-tab="home"><i class="fas fa-home"></i><span>Home</span></button>
      <button class="page-tab" data-page-tab="about"><i class="fas fa-user"></i><span>About</span></button>
      <button class="page-tab" data-page-tab="experience"><i class="fas fa-briefcase"></i><span>Experience</span></button>
      <button class="page-tab" data-page-tab="skills"><i class="fas fa-wand-magic-sparkles"></i><span>Skills</span></button>
    </div>
    <div id="successMessage" class="message success"></div>
    <div id="errorMessage" class="message error"></div>

    <div class="section active" data-page-section="home">
      <h2><i class="fas fa-home"></i> Home Page</h2>
      <details open>
        <summary>Hero & Learn More</summary>
        <form id="homeContentForm">
          <div class="form-group">
            <label for="homeHeroTitleInput">Hero Title</label>
            <input type="text" id="homeHeroTitleInput" />
          </div>
          <div class="form-group">
            <label for="homeHeroSubtitleInput">Hero Subtitle</label>
            <input type="text" id="homeHeroSubtitleInput" />
          </div>
          <div class="form-group">
            <label for="homeHeroButtonTextInput">Hero Button Text</label>
            <input type="text" id="homeHeroButtonTextInput" />
          </div>
          <div class="form-group">
            <label for="homeLearnMoreTitleInput">"Learn More" Section Title</label>
            <input type="text" id="homeLearnMoreTitleInput" />
          </div>
          <div class="form-group">
            <label for="homeCtaTitleInput">Bottom Call-to-Action Title</label>
            <input type="text" id="homeCtaTitleInput" />
          </div>
          <div class="form-group">
            <label for="homeCtaTextInput">Bottom Call-to-Action Text</label>
            <textarea id="homeCtaTextInput" rows="3"></textarea>
          </div>
          <button type="submit" class="btn"><i class="fas fa-save"></i> Save Home Content</button>
        </form>
      </details>

      <div class="preview-grid">
        <div class="preview-card">
          <h3><span class="label">Live</span> Home hero & CTA</h3>
          <div class="page-preview">
            <h4 id="homeLive_heroTitle">Capturing Moments, Creating Stories</h4>
            <p id="homeLive_heroSubtitle" class="preview-tagline">Photography &amp; Cinematography by Dominic Martinez</p>
            <span id="homeLive_heroButtonText" class="preview-cta">View Portfolio</span>
            <p id="homeLive_learnMoreTitle" style="margin-top:10px; font-weight:600;">About the Work</p>
            <h4 id="homeLive_ctaTitle" style="margin-top:8px;">Ready to Create Something Amazing?</h4>
            <p id="homeLive_ctaText">Let's bring your vision to life with professional photography and cinematography.</p>
          </div>
        </div>
        <div class="preview-card">
          <h3><span class="label">Draft</span> Home hero & CTA</h3>
          <div class="page-preview">
            <h4 id="homeDraft_heroTitle"></h4>
            <p id="homeDraft_heroSubtitle" class="preview-tagline"></p>
            <span id="homeDraft_heroButtonText" class="preview-cta"></span>
            <p id="homeDraft_learnMoreTitle" style="margin-top:10px; font-weight:600;"></p>
            <h4 id="homeDraft_ctaTitle" style="margin-top:8px;"></h4>
            <p id="homeDraft_ctaText"></p>
          </div>
        </div>
      </div>
    </div>

    <div class="section" data-page-section="about">
      <h2><i class="fas fa-user"></i> About Page</h2>
      <details open>
        <summary>Hero & About Text</summary>
        <form id="aboutContentForm">
          <div class="form-group">
            <label for="aboutHeroTitleInput">Hero Title</label>
            <input type="text" id="aboutHeroTitleInput" />
          </div>
          <div class="form-group">
            <label for="aboutHeroSubtitleInput">Hero Subtitle</label>
            <input type="text" id="aboutHeroSubtitleInput" />
          </div>
          <div class="form-group">
            <label for="aboutNameHeadingInput">Name Heading</label>
            <input type="text" id="aboutNameHeadingInput" />
          </div>
          <div class="form-group">
            <label for="aboutP1Input">Paragraph 1</label>
            <textarea id="aboutP1Input" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label for="aboutP2Input">Paragraph 2</label>
            <textarea id="aboutP2Input" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label for="aboutP3Input">Paragraph 3</label>
            <textarea id="aboutP3Input" rows="3"></textarea>
          </div>
          <button type="submit" class="btn"><i class="fas fa-save"></i> Save About Content</button>
        </form>
      </details>

      <div class="preview-grid">
        <div class="preview-card">
          <h3><span class="label">Live</span> About intro</h3>
          <div class="page-preview">
            <h4 id="aboutLive_heroTitle">About Me</h4>
            <p id="aboutLive_heroSubtitle" class="preview-tagline">Photographer &amp; Cinematographer | San Antonio, TX</p>
            <p id="aboutLive_nameHeading" style="margin-top:8px; font-weight:600;">Hi, I’m Dominic.</p>
            <p id="aboutLive_paragraph1"></p>
            <p id="aboutLive_paragraph2"></p>
            <p id="aboutLive_paragraph3"></p>
          </div>
        </div>
        <div class="preview-card">
          <h3><span class="label">Draft</span> About intro</h3>
          <div class="page-preview">
            <h4 id="aboutDraft_heroTitle"></h4>
            <p id="aboutDraft_heroSubtitle" class="preview-tagline"></p>
            <p id="aboutDraft_nameHeading" style="margin-top:8px; font-weight:600;"></p>
            <p id="aboutDraft_paragraph1"></p>
            <p id="aboutDraft_paragraph2"></p>
            <p id="aboutDraft_paragraph3"></p>
          </div>
        </div>
      </div>
    </div>

    <div class="section" data-page-section="experience">
      <h2><i class="fas fa-briefcase"></i> Experience Page</h2>
      <details open>
        <summary>Headings</summary>
        <form id="experienceContentForm">
          <div class="form-group">
            <label for="experienceHeroTitleInput">Hero Title</label>
            <input type="text" id="experienceHeroTitleInput" />
          </div>
          <div class="form-group">
            <label for="experienceHeroSubtitleInput">Hero Subtitle</label>
            <input type="text" id="experienceHeroSubtitleInput" />
          </div>
          <div class="form-group">
            <label for="experienceWorkHeadingInput">Work Experience Heading</label>
            <input type="text" id="experienceWorkHeadingInput" />
          </div>
          <div class="form-group">
            <label for="experienceEducationHeadingInput">Education Heading</label>
            <input type="text" id="experienceEducationHeadingInput" />
          </div>
          <button type="submit" class="btn"><i class="fas fa-save"></i> Save Experience Content</button>
        </form>
      </details>

      <div class="preview-grid">
        <div class="preview-card">
          <h3><span class="label">Live</span> Experience hero & headings</h3>
          <div class="page-preview">
            <h4 id="experienceLive_heroTitle">Experience</h4>
            <p id="experienceLive_heroSubtitle" class="preview-tagline">Professional Background &amp; Education</p>
            <p id="experienceLive_workHeading" style="margin-top:8px; font-weight:600;">Work Experience</p>
            <p id="experienceLive_educationHeading" style="font-weight:600;">Education</p>
          </div>
        </div>
        <div class="preview-card">
          <h3><span class="label">Draft</span> Experience hero & headings</h3>
          <div class="page-preview">
            <h4 id="experienceDraft_heroTitle"></h4>
            <p id="experienceDraft_heroSubtitle" class="preview-tagline"></p>
            <p id="experienceDraft_workHeading" style="margin-top:8px; font-weight:600;"></p>
            <p id="experienceDraft_educationHeading" style="font-weight:600;"></p>
          </div>
        </div>
      </div>
    </div>

    <div class="section" data-page-section="skills">
      <h2><i class="fas fa-wand-magic-sparkles"></i> Skills Page</h2>
      <details open>
        <summary>Hero & Call To Action</summary>
        <form id="skillsContentForm">
          <div class="form-group">
            <label for="skillsHeroTitleInput">Hero Title</label>
            <input type="text" id="skillsHeroTitleInput" />
          </div>
          <div class="form-group">
            <label for="skillsHeroSubtitleInput">Hero Subtitle</label>
            <input type="text" id="skillsHeroSubtitleInput" />
          </div>
          <div class="form-group">
            <label for="skillsCtaTitleInput">Bottom Call-to-Action Title</label>
            <input type="text" id="skillsCtaTitleInput" />
          </div>
          <div class="form-group">
            <label for="skillsCtaTextInput">Bottom Call-to-Action Text</label>
            <textarea id="skillsCtaTextInput" rows="3"></textarea>
          </div>
          <button type="submit" class="btn"><i class="fas fa-save"></i> Save Skills Content</button>
        </form>
      </details>

      <div class="preview-grid">
        <div class="preview-card">
          <h3><span class="label">Live</span> Skills hero & CTA</h3>
          <div class="page-preview">
            <h4 id="skillsLive_heroTitle">Skills</h4>
            <p id="skillsLive_heroSubtitle" class="preview-tagline">Professional Expertise &amp; Technical Proficiency</p>
            <h4 id="skillsLive_ctaTitle" style="margin-top:8px;">Ready to build something together?</h4>
            <p id="skillsLive_ctaText"></p>
          </div>
        </div>
        <div class="preview-card">
          <h3><span class="label">Draft</span> Skills hero & CTA</h3>
          <div class="page-preview">
            <h4 id="skillsDraft_heroTitle"></h4>
            <p id="skillsDraft_heroSubtitle" class="preview-tagline"></p>
            <h4 id="skillsDraft_ctaTitle" style="margin-top:8px;"></h4>
            <p id="skillsDraft_ctaText"></p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
  <script src="/assets/js/firebase-config.js"></script>
  <script src="/assets/js/firebase-init-compat.js"></script>
  <script>
    const auth = firebase.auth();
    const db = firebase.firestore();
    const ADMIN_UID = "RVAvU26oGeYsaJYk0X1OF9h6apb2";
    const publishedContent = {};

    const mappingByDoc = {
      home: {
        heroTitle: 'homeHeroTitleInput',
        heroSubtitle: 'homeHeroSubtitleInput',
        heroButtonText: 'homeHeroButtonTextInput',
        learnMoreTitle: 'homeLearnMoreTitleInput',
        ctaTitle: 'homeCtaTitleInput',
        ctaText: 'homeCtaTextInput'
      },
      about: {
        heroTitle: 'aboutHeroTitleInput',
        heroSubtitle: 'aboutHeroSubtitleInput',
        nameHeading: 'aboutNameHeadingInput',
        paragraph1: 'aboutP1Input',
        paragraph2: 'aboutP2Input',
        paragraph3: 'aboutP3Input'
      },
      experience: {
        heroTitle: 'experienceHeroTitleInput',
        heroSubtitle: 'experienceHeroSubtitleInput',
        workHeading: 'experienceWorkHeadingInput',
        educationHeading: 'experienceEducationHeadingInput'
      },
      skills: {
        heroTitle: 'skillsHeroTitleInput',
        heroSubtitle: 'skillsHeroSubtitleInput',
        ctaTitle: 'skillsCtaTitleInput',
        ctaText: 'skillsCtaTextInput'
      }
    };

    function showMessage(id, text) {
      const el = document.getElementById(id);
      if (!el) return;
      el.textContent = text;
      el.classList.add('show');
      setTimeout(() => el.classList.remove('show'), 4000);
    }

    function logout() {
      auth.signOut().then(() => {
        window.location.href = 'dashboard.html';
      });
    }

    function attachHeaderHandlers() {
      const backBtn = document.getElementById('backBtn');
      if (backBtn) {
        backBtn.addEventListener('click', () => {
          window.location.href = 'dashboard.html';
        });
      }
      const logoutBtn = document.getElementById('logoutBtn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', logout);
      }
    }

    auth.onAuthStateChanged(async (user) => {
      if (!user || user.uid !== ADMIN_UID) {
        window.location.href = 'dashboard.html';
        return;
      }
      attachHeaderHandlers();
      initPageTabs();
      await loadAllContent();
      setupFormHandlers();
    });

    async function loadAllContent() {
      await Promise.all([
        loadDocIntoInputs('home', mappingByDoc.home),
        loadDocIntoInputs('about', mappingByDoc.about),
        loadDocIntoInputs('experience', mappingByDoc.experience),
        loadDocIntoInputs('skills', mappingByDoc.skills)
      ]);
    }

    async function loadDocIntoInputs(docId, mapping) {
      try {
        const snap = await db.collection('siteContent').doc(docId).get();
        if (!snap.exists) {
          publishedContent[docId] = {};
          renderPreviews(docId);
          return;
        }
        const data = snap.data();
        publishedContent[docId] = data || {};
        Object.keys(mapping).forEach(key => {
          const inputId = mapping[key];
          const el = document.getElementById(inputId);
          if (el && data[key] != null) {
            el.value = data[key];
          }
        });
        renderPreviews(docId);
      } catch (err) {
        console.error('Error loading content for', docId, err);
      }
    }

    function setupFormHandlers() {
      const homeForm = document.getElementById('homeContentForm');
      if (homeForm) {
        homeForm.addEventListener('submit', (e) => saveContentForm(e, 'home'));
        homeForm.querySelectorAll('input, textarea').forEach(el => {
          el.addEventListener('input', () => updateDraftPreview('home'));
        });
      }
      const aboutForm = document.getElementById('aboutContentForm');
      if (aboutForm) {
        aboutForm.addEventListener('submit', (e) => saveContentForm(e, 'about'));
        aboutForm.querySelectorAll('input, textarea').forEach(el => {
          el.addEventListener('input', () => updateDraftPreview('about'));
        });
      }
      const expForm = document.getElementById('experienceContentForm');
      if (expForm) {
        expForm.addEventListener('submit', (e) => saveContentForm(e, 'experience'));
        expForm.querySelectorAll('input, textarea').forEach(el => {
          el.addEventListener('input', () => updateDraftPreview('experience'));
        });
      }
      const skillsForm = document.getElementById('skillsContentForm');
      if (skillsForm) {
        skillsForm.addEventListener('submit', (e) => saveContentForm(e, 'skills'));
        skillsForm.querySelectorAll('input, textarea').forEach(el => {
          el.addEventListener('input', () => updateDraftPreview('skills'));
        });
      }
    }

    async function saveContentForm(e, docId) {
      e.preventDefault();
      const user = auth.currentUser;
      if (!user || user.uid !== ADMIN_UID) {
        showMessage('errorMessage', '❌ You are not authorized to update site content.');
        return;
      }

      const mapping = mappingByDoc[docId];
      if (!mapping) return;

      const payload = {};
      Object.keys(mapping).forEach(key => {
        const inputId = mapping[key];
        const el = document.getElementById(inputId);
        if (el) payload[key] = el.value;
      });

      try {
        await db.collection('siteContent').doc(docId).set(payload, { merge: true });
        publishedContent[docId] = Object.assign({}, publishedContent[docId] || {}, payload);
        renderPreviews(docId);
        showMessage('successMessage', `✓ ${docId.charAt(0).toUpperCase() + docId.slice(1)} content saved!`);
      } catch (err) {
        console.error('Error saving content for', docId, err);
        showMessage('errorMessage', '❌ Error saving content: ' + (err.message || 'Please try again.'));
      }
    }

    function renderPreviews(docId) {
      const mapping = mappingByDoc[docId];
      if (!mapping) return;
      const data = publishedContent[docId] || {};

      Object.keys(mapping).forEach(key => {
        const liveEl = document.getElementById(`${docId}Live_${key}`);
        if (liveEl) {
          liveEl.textContent = data[key] || '';
        }
      });

      updateDraftPreview(docId);
    }

    function updateDraftPreview(docId) {
      const mapping = mappingByDoc[docId];
      if (!mapping) return;
      Object.keys(mapping).forEach(key => {
        const inputId = mapping[key];
        const input = document.getElementById(inputId);
        const draftEl = document.getElementById(`${docId}Draft_${key}`);
        if (input && draftEl) {
          draftEl.textContent = input.value || '';
        }
      });
    }

    function initPageTabs() {
      const tabs = document.querySelectorAll('.page-tab');
      const sections = document.querySelectorAll('.section[data-page-section]');

      function showPage(page) {
        sections.forEach(sec => {
          if (sec.dataset.pageSection === page) {
            sec.classList.add('active');
          } else {
            sec.classList.remove('active');
          }
        });
        tabs.forEach(tab => {
          if (tab.dataset.pageTab === page) {
            tab.classList.add('active');
          } else {
            tab.classList.remove('active');
          }
        });
      }

      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          const page = tab.dataset.pageTab;
          if (page) showPage(page);
        });
      });

      showPage('home');
    }
  </script>
</body>
</html>
